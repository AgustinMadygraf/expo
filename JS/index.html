<!DOCTYPE html>
<html>
<head>
    <title>Formulario FSC</title>
    <script type="text/javascript" src="loader.js"></script>
    <script type="text/javascript">
        google.charts.load('current', {'packages':['gauge']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {
            var vel_ult = 0;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    vel_ult = parseInt(this.responseText);
                    var data = google.visualization.arrayToDataTable([
                        ['Label', 'Value'],
                        ['[RPM]', vel_ult]
                    ]);

                    var options = {
                        width: 800, height: 800,
                        greenFrom:0, greenTo:250,
                        redFrom: 900, redTo: 1500,
                        yellowFrom:750, yellowTo: 900,
                        minorTicks: 5,
                        max:1500
                    };

                    var chart = new google.visualization.Gauge(document.getElementById('chart_div'));
                    chart.draw(data, options);
                }
            };
            xhttp.open("GET", "datos.csv", true);
            xhttp.send();

            var form = document.getElementById("formulario");

            form.addEventListener("submit", function(e) {
                e.preventDefault();
                var velocidad = document.getElementById("velocidad").value;
                var tiempo = new Date().getTime() / 1000;

                var xhttp = new XMLHttpRequest();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200) {
                        console.log("Los datos han sido ingresados correctamente en el archivo datos.csv");
                        console.log("Velocidad: " + velocidad);
                        console.log("Tiempo: " + tiempo);
                        form.reset();
                    }
                };
                xhttp.open("POST", "procesar.php", true);
                xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
                xhttp.send("velocidad=" + velocidad + "&tiempo=" + tiempo);
            });
        }
    </script>
</head>
<body>
    <h1> Velocidad m√°quina</h1>
    <form action="procesar.php" method="post">
        <table>
            <tr>
                <th><label for="velocidad">RPM</label></th>
                <th><input type="number" id="velocidad" name="velocidad"></th>
            </tr> 
            <tr>
                <th><label>Tiempo:</label></th>
                <th><input value="" readonly></th>
            </tr> 
            <tr>
                <th></th>
                <th><input type="hidden" id="tiempo" name="tiempo" value=""></th>
            </tr>
            <tr>
                <th colspan="2"><input type="submit" name="submit" value="Enviar"></th>
            </tr>
        </table>
    </form>

    <div id="chart_div"></div>

    <meta http-equiv="refresh" content="60;index.php">
</body>
</html>
